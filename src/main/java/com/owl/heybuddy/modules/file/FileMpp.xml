<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.owl.heybuddy.modules.file.FileMpp"> <!-- 지금 파일 지정 -->

	<resultMap id="resultMapObj" type="com.owl.heybuddy.modules.file.File"></resultMap> <!-- 결과 객체 저장 -->
 
  
 
<!--  ************************* 문서관련mpp*************************  -->
<!--  ************************* 문서관련mpp*************************  -->
<!--  ************************* 문서관련mpp*************************  -->
 
 
	
	<sql id="selectCommon"> <!-- 공통 -->
		FROM
		hybdDocument a
		WHERE 1 = 1 
		<choose>
			<when test="shHydcDelNy == 1">AND hydcDelNy = 1 </when>   
			<when test="shHydcDelNy == 0">AND hydcDelNy = 0 </when>  
		</choose>
			<if test="shHydcTitle != null and !shHydcTitle.equals('')"> AND hydcName LIKE concat('%',#{shHydcTitle},'%')</if>
		
		<choose>
			<when test="shHydcOption == 1">AND hydcTitle LIKE concat('%',#{shHydcValue},'%')</when>
			<when test="shHydcOption == 2">AND hydcText LIKE concat('%',#{shHydcValue},'%')</when>
		</choose>
	</sql>
	


	<select id="selectOneCount" resultType="Integer">   <!-- selectCommon 사용 / 페이징 -->
		select
		count(*)
		<include refid="selectCommon"/>
	</select>
 

<select id="documentList" resultMap="resultMapObj">  <!-- 문서리스트-->
		select
		*
		,b.hymmName
		from
		hybdDocument a
		left join hybdMember b on b.hymmSeq = a.hymmSeq 
		where
		hydcDelNy = 0
		<if test="shHydcTitle != null and !shHydcTitle.equals('')"> AND hydcName LIKE concat('%',#{shHydcTitle},'%')</if>
		
		<choose>
			<when test="shHydcOption == 1">AND hydcTitle LIKE concat('%',#{shHydcValue},'%')</when>
			<when test="shHydcOption == 2">AND hydcText LIKE concat('%',#{shHydcValue},'%')</when>
		</choose>
		limit  #{startRnumForMysql} , #{rowNumToShow}
	
	</select>
	
	
 	<select id="documentView" resultMap="resultMapObj">   <!-- 문서뷰 셀렉원 -->
		select
		*
		from
		hybdDocument
		where 1=1
		and hydcDelNy = 0
		and hymmSeq = #{hymmSeq}
	</select>
	
		<insert id="insertDocument">  <!-- 문서등록 -->
		INSERT INTO hybdDocument(
		hybdTitle
		,hybdText
		,hybdDelNy
		,regIp
		,regSeq
		,regDevice
		,regDateTime
		,regDateTimeSvr
		,hyspSeq
		,hymmSeq
		)
		VALUES(
		#{hybdTitle}
		,#{hybdText} 
		,0
		,#{regIp}
		,#{regSeq}
		,#{regDevice}
		,#{regDateTime} 
		,#{regDateTimeSvr} 
		,#{hyspSeq} 
		,#{hymmSeq}
		)
</insert>

	<update id="updateDocument">  <!-- 문서수정 -->
		UPDATE hybdDocument SET
		hybdTitle  =  #{hybdTitle}
		,hybdText =  #{hybdText}
		,hybdmmDelny =  0
		,hybdmmDesc = #{hybdmmDesc}
		,modIp =  #{modIp}
		,modSeq =  #{modSeq}
		,modDevice =  #{modDevice}
		,modDateTime =  now()
		,modDateTimeSvr =  now()
		WHERE 1 = 1
		AND hymmSeq = #{hymmSeq}
	</update>


<!--  ************************* 파일관련mpp*************************  -->
<!--  ************************* 파일관련mpp*************************  -->
<!--  ************************* 파일관련mpp*************************  -->


	<insert id="insertUploaded">  <!-- 파일등록 -->
		INSERT INTO ${tableName}(
		defaultNy
		,type 
		,sort
		,originalFileName
		,uuidFileName
		,ext
 		,size 
		,delNY
		,pseq
		,path
		,hymmSeq
		)
		VALUES(
		#{defaultNy}
		,#{type} 
		,#{sort}
		,#{originalFileName}
		,#{uuidFileName}
		,#{ext}
		,#{size} 
		,0
		,#{pseq}
		,#{path}
		,#{hymmSeq}
		)
</insert>

	<select id="fileUploaded" resultMap = "resultMapObj"> <!--파일뷰 -->
		SELECT
			seq
<!-- 			, type -->
			, defaultNy
<!-- 			, sort -->
			, originalFileName
			, uuidFileName 
			, ext
			, size 
			, delNy
			, pseq
			, path
		FROM
			hybdFileUploaded
		WHERE 1=1
			AND pseq = #{hymmSeq}
	</select>
	
	
</mapper>
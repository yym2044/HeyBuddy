<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.owl.heybuddy.modules.plan.PlanMpp"> <!-- 지금 파일 지정 -->

	<resultMap id="resultMapObj"
		type="com.owl.heybuddy.modules.plan.Plan"></resultMap> <!-- 결과 객체 저장 -->


	<sql id="selectCommon">
		FROM
		hybdPlan a
		LEFT JOIN
		hyplPlanPhone b ON a.hyplSeq = b.hyplSeq
		LEFT JOIN
		hyplPlanEmail c ON a.hyplSeq = c.hyplSeq
		WHERE 1=1
		<choose>
			<!-- <when test="shOptionDate == 0">AND a.regDateTime disabled #{shDateStart} 
				AND #{shDateEnd}</when> -->
			<when test="shOptionDate == 1">AND a.regDateTime BETWEEN #{shDateStart} AND
				#{shDateEnd}</when>
			<when test="shOptionDate == 2">AND a.modDateTime BETWEEN #{shDateStart} AND
				#{shDateEnd}</when>
			<!-- <when test="shOptionDate == 3">AND a.hyplDob BETWEEN #{shDateStart} 
				AND #{shDateEnd}</when> -->
			<!-- <when test="shJoinOption == 5">AND a.regDateTime LIKE concat('%',#{shJoinValue},'%')</when> -->
			<!-- <when test="shJoinOption == 6">AND regDateTime LIKE concat('%',#{shJoinValue},'%')</when> -->
		</choose>
		<choose>
			<when test="shOption == 1">AND a.hyplName LIKE concat('%',#{shValue}, '%')
			</when>
			<when test="shOption == 2">AND a.hyplId LIKE concat('%',#{shValue}, '%')</when>
			<when test="shOption == 3">AND b.ifmpNumber LIKE concat('%',#{shValue}, '%')
			</when>
			<when test="shOption == 4">AND c.ifmeEmailFull LIKE concat('%',#{shValue}, '%')
			</when>
			<!-- <when test="shOption == 5">AND a.regDateTime LIKE concat('%',#{shValue}, 
				'%')</when> -->
		</choose>

	</sql>

	<select id="selectOneCount" resultType="Integer">
		SELECT
		count(*)
		<include refid="selectCommon" />

	</select>

	<select id="selectList" resultMap="resultMapObj">
		SELECT
		a.hyplSeq
		,a.hyplName
		,a.hyplId
		,a.hyplDelNy
		,b.ifmpNumber
		,c.ifmeEmailFull
		,a.regDateTime
		<!-- ,a.hyplPassword -->
		<include refid="selectCommon" />
		limit #{startRnumForMysql}, #{rowNumToShow}
	</select>

	<select id="" resultMap="resultMapObj">
		SELECT
		a.ifnSeq
		,a.ifnName
		FROM
		hyplNationality a
		WHERE 1 = 1
	</select>




	<insert id="insert">
		INSERT INTO hybdPlan (
		hyplName
		,hyplNameEng
		,hyplId
		,hyplDelNy
		,hyplPassword
		,hyplPassword2
		,hyplDob
		,hyplGenderCd
		,regDateTime
		,hyplEmailConsentNy
		,originalFileName
		,uuidFileName
		)
		VALUES (
		#{hyplName}
		,#{hyplNameEng}
		,#{hyplId}
		,0
		,#{hyplPassword}
		,#{hyplPassword2}
		,#{hyplDob}
		,#{hyplGenderCd}
		,#{regDateTime}
		,#{hyplEmailConsentNy}
		,#{originalFileName}
		,#{uuidFileName}
		)
		<selectKey resultType="String" keyProperty="hyplSeq"
			order="AFTER">
			SELECT last_insert_id()
		</selectKey>
	</insert>


	<select id="selectOne" resultMap="resultMapObj">
		SELECT
		a.hyplSeq
		,a.hyplName
		,a.hyplNameEng
		,a.hyplId
		,a.hyplDelNy
		,a.hyplPassword
		,a.hyplPassword2
		,a.hyplDob
		,a.regDateTime
		,(select ifcdName from hybdCode where ifcdSeq
		= a.hyplEmailConsentNy) as hyplMarketing
		,a.originalFileName
		,a.uuidFileName
		,b.ifmpNumber
		,(select ifcdName from hybdCode where
		ifcdSeq = b.ifmpTelecomCd) as ifmpTelecompany
		,c.ifmeEmailFull
		,d.ifmaAddress1
		,d.ifmaAddress2
		,d.ifmaZipcode
		,d.ifmaLat
		,d.ifmaLng
		,(select ifnName from hyplNationality where ifnSeq = e.ifnSeq) as
		ifnNation
		,g.ifcdName
		FROM
		hybdPlan a
		LEFT JOIN
		hybdPlanPhone b ON
		a.hyplSeq = b.hyplSeq
		LEFT JOIN
		hyplPlanEmail c ON a.hyplSeq =
		c.hyplSeq
		LEFT JOIN
		hyplPlanAddress d ON a.hyplSeq = d.hyplSeq
		LEFT
		JOIN
		hyplPlanNationality e ON a.hyplSeq = e.hyplSeq
		LEFT JOIN
		hyplCode
		g ON g.ifcdSeq = a.hyplGenderCd
		WHERE
		1 = 1
		AND a.hyplSeq = #{hyplSeq}
	</select>


	<update id="update">
		UPDATE
		hyplPlan  <!-- 진짜 중요한게 테이블 이름틀리면 505 Error 불변임 -->
		SET
		hyplName = #{hyplName} <!-- 여기다 여러개 넣으면 여러개 수정 함께 가능 -->
		,hyplNameEng = #{hyplNameEng}
		,hyplGenderCd = #{hyplGenderCd}
		,hyplEmailConsentNy = #{hyplEmailConsentNy}
		,hyplId = #{hyplId}
		,hyplPassword = #{hyplPassword} <!-- 여기다 여러개 넣으면 여러개 수정 함께 가능 -->
		,regDateTime = #{regDateTime}
		WHERE
		1 = 1
		AND hyplSeq = #{hyplSeq}
	</update>

<!-- 	<update id="">
		UPDATE
		hybdPlanPhone
		SET
		ifmpNumber = #{ifmpNumber}
		,ifmpTelecomCd = #{ifmpTelecomCd}
		WHERE
		1 = 1
		AND hyplSeq = #{hyplSeq}
	</update>
 -->

	<!-- <delete id="delete">
		DELETE FROM hybdPlan WHERE 1=1 AND hyplSeq = #{hyplSeq} 시퀀스가 같은 것을 
			삭제시키겠다.
	</delete> -->

</mapper>